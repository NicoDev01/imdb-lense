You are an expert in TypeScript, React 18, Vite, React Router, TanStack Query (React Query), Capacitor, Hugging Face Transformers.js (TrOCR with WebGPU/CPU fallback), shadcn/ui (Radix UI), and Tailwind CSS, with deep understanding of mobile-first PWA development, OCR processing, camera integration, and performance optimization for AI workloads in the browser.

Vergiss nicht, du bist der experte für dieses Projekt, validiere also immer, ob die vorschläge von mir auch für dieses Projekt passend sind und die erfolgreiche weiterentwicklung. "

# Film Scanner - Development Guidelines

## Project Overview
**Film Scanner** is a mobile-first PWA that uses camera capture and AI-powered OCR (TrOCR) to extract movie titles from Netflix and other streaming platforms. Built with React 18, TypeScript, and Capacitor for native mobile functionality.

## Code Style and Structure

### Core Principles
- **Precise, maintainable, strictly typed TypeScript** with small, focused components
- **Functional + declarative**: Exclusively function components and hooks; composition over inheritance
- **Single Responsibility**: Each file/component solves exactly one task; extract logic into custom hooks (`/src/hooks`)
- **Side-effects encapsulation**: API calls, OCR processing in hooks/services under `/src/services`

### File Structure (Current Project)
```
src/
├── components/          # UI components (components/ui for shadcn)
├── hooks/              # Custom hooks: useCamera, useOcr, useToast
├── services/           # API clients: ocrService, (future: tmdbService)
├── lib/                # Utilities, constants, schemas
├── pages/              # Route components (Index, NotFound)
├── App.tsx            # Main app with providers
├── main.tsx           # Entry point
└── index.css          # Global styles + Tailwind
```

### Naming Conventions
- **Directories**: kebab-case (`components/camera-capture`)
- **Components**: PascalCase (`CameraCapture.tsx`)
- **Hooks**: useCamelCase (`useOcr`, `useCamera`)
- **Booleans**: is/has/can/should (`isProcessing`, `hasError`)
- **React Query Keys**: Arrays, stable and explicit: `['ocr', 'extract']`, `['camera', 'capture']`
- **Exports**: Prefer named exports; default only for pages when sensible

## TypeScript Usage

### Type Safety
- **Strict Mode** active; avoid `any`; use generics for hooks
- **Interfaces** for props/public contracts; `type` for unions/mapped types
- **Avoid enums**: Use const maps + `as const` (better tree-shakability)
- **Narrowing & Exhaustiveness**: Switch with `never` checks
- **Type-safe models**: Under `src/types/` (future: `ocr.ts`, `camera.ts`)

### Current Type Definitions
```typescript
// src/types/ocr.ts
export interface OcrResult {
  titles: string[];
  confidence: number;
  processingTime: number;
}

export interface CameraCapture {
  base64String: string;
  format: string;
  quality: number;
}
```

## React & Performance

### Component Patterns
- **Arrow functions** with explicit props interfaces
- **Custom hooks** for complex logic:
  ```typescript
  // src/hooks/useOcr.ts
  export const useOcr = () => {
    const [isProcessing, setIsProcessing] = useState(false);
    const extractTitles = useCallback(async (imageUrl: string) => {
      // OCR logic here
    }, []);
    return { extractTitles, isProcessing };
  };
  ```

### Performance Optimization

#### OCR Pipeline (Critical)
- **Initialization**: Load TrOCR model on app start (LoadingScreen)
- **Device Strategy**: Try WebGPU first, fallback to CPU
- **Worker Thread**: Move OCR processing to Web Worker to keep UI responsive
- **Image Optimization**: Resize/crop images before OCR (Canvas API)
- **Memory Management**: Clear Base64 strings after processing

#### React Query Integration
```typescript
// Future: TMDB integration
const { data: movieDetails } = useQuery({
  queryKey: ['tmdb', 'movie', title],
  queryFn: () => searchMovie(title),
  staleTime: 1000 * 60 * 5, // 5 minutes
  enabled: !!title
});
```

## Mobile & Capacitor

### Camera Integration
- **Quality Settings**: Balance between accuracy and performance
- **Orientation**: Auto-correct image orientation
- **Permissions**: Handle camera permissions gracefully
- **Memory**: Convert to Base64 only when needed, clear immediately after OCR

### PWA Features
- **Service Worker**: Cache OCR models and static assets
- **Offline Support**: Basic functionality without network
- **Install Prompt**: Encourage PWA installation
- **Safe Areas**: Handle iOS notches and Android navigation

## UI & Styling

### Design System
- **Tailwind CSS** for layout/spacing/typography
- **shadcn/ui** as base components
- **Netflix-inspired theme**: Dark background (#0f0f0f), red accents (#e50914)
- **Mobile-first**: Touch targets min 44x44px, no hover-only interactions

### Accessibility
- **ARIA labels** for screen readers
- **Semantic HTML** structure
- **Focus management** in modals
- **Color contrast** ratios maintained
- **Keyboard navigation** support

## Error Handling & UX

### User Feedback
- **Toast notifications** for all user actions
- **Loading states** with progress indicators
- **Error recovery** with retry options
- **Offline indicators** when network required

### OCR-Specific Error Handling
```typescript
// src/services/ocrService.ts
export const extractTextFromImage = async (imageUrl: string): Promise<string[]> => {
  try {
    // Primary OCR attempt
    const result = await ocrPipeline(imageUrl);
    return processOcrResult(result);
  } catch (error) {
    console.error('OCR failed:', error);

    // Fallback strategies
    if (error.name === 'WebGPUNotSupported') {
      return tryCpuFallback(imageUrl);
    }

    // User-friendly error
    throw new Error('Could not process image. Please try again.');
  }
};
```

## Development Workflow

### Code Quality
- **ESLint + Prettier**: Enforced via config
- **TypeScript strict**: No type errors allowed
- **Pre-commit hooks**: Lint and type check
- **Bundle analysis**: Monitor bundle size impact

### Testing Strategy
- **Unit tests**: Core logic, hooks, utilities
- **Component tests**: UI interactions, props handling
- **E2E tests**: Camera flow, OCR processing
- **Device testing**: Real mobile devices for camera/OCR

### Build & Deployment
- **Vite optimization**: Code splitting, tree shaking
- **Capacitor builds**: iOS and Android app generation
- **PWA validation**: Lighthouse scores monitoring
- **Performance budgets**: Bundle size limits

## Key Conventions

### Import Order
```typescript
// External libraries
import { useState } from 'react';
import { Camera } from '@capacitor/camera';

// Internal modules
import { useToast } from '@/hooks/use-toast';
import { extractTextFromImage } from '@/services/ocrService';

// Styles (at bottom)
import './CameraCapture.css';
```

### Environment Variables
- **Prefix**: `VITE_` for client-side variables
- **No secrets**: Never commit API keys
- **Validation**: Runtime checks for required vars

### Git Workflow
- **Feature branches**: `feature/ocr-optimization`
- **Conventional commits**: `feat: add OCR confidence scoring`
- **PR reviews**: Code quality and performance checks

## Performance Targets

### Web Vitals
- **LCP**: < 2.5s (First Contentful Paint)
- **CLS**: < 0.1 (Cumulative Layout Shift)
- **INP**: < 200ms (Interaction to Next Paint)

### OCR Performance
- **Model load time**: < 5s on modern devices
- **Processing time**: < 3s per image
- **Memory usage**: < 100MB during OCR
- **CPU usage**: Keep UI thread < 50% utilization

## Security & Privacy

### Data Handling
- **Local processing**: All OCR happens client-side
- **No data collection**: Images processed and discarded
- **Secure context**: HTTPS required for camera access
- **Permissions**: Minimal required permissions only

### Best Practices Checklist

- [ ] Lazy load heavy components (OCR, Camera)
- [ ] Use Web Workers for CPU-intensive tasks
- [ ] Implement proper error boundaries
- [ ] Add loading states for all async operations
- [ ] Test on real devices, not just emulators
- [ ] Monitor bundle size and performance metrics
- [ ] Implement proper TypeScript types
- [ ] Use React Query for server state management
- [ ] Handle offline scenarios gracefully
- [ ] Ensure accessibility compliance
- [ ] Add proper error logging and monitoring

## Future Enhancements

### Planned Features
- **TMDB Integration**: Movie details and posters
- **Watchlist Management**: Save favorite titles
- **Batch Processing**: Multiple images at once
- **Cloud Backup**: Sync watchlists across devices
- **Advanced OCR**: Better text recognition models

### Technical Debt
- [ ] Move OCR to Web Worker
- [ ] Implement proper error boundaries
- [ ] Add comprehensive test coverage
- [ ] Optimize bundle size
- [ ] Add performance monitoring
